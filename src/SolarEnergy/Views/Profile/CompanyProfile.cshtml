@model SolarEnergy.ViewModels.CompanyProfileViewModel
@using SolarEnergy.Extensions
@{
    ViewData["Title"] = "Perfil da Empresa";
    var profileImage = string.IsNullOrWhiteSpace(Model.ProfileImagePath)
        ? Url.Content("~/images/default-profile.svg")
        : Url.Content(Model.ProfileImagePath.StartsWith("/") ? "~" + Model.ProfileImagePath : Model.ProfileImagePath);

    var companyDisplayName = !string.IsNullOrWhiteSpace(Model.CompanyTradeName) 
        ? Model.CompanyTradeName 
        : (!string.IsNullOrWhiteSpace(Model.CompanyLegalName) ? Model.CompanyLegalName : Model.FullName);
}

<link href="~/css/company-profile.css" rel="stylesheet" asp-append-version="true" />

<section class="py-4 bg-gradient-light">
    <div class="container">
        <!-- Header da Empresa -->
        <div class="company-profile-header mb-4">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <div class="d-flex align-items-center">
                        <div class="company-avatar me-4">
                            <img src="@profileImage" alt="Logo da @companyDisplayName" class="img-fluid" />
                        </div>
                        <div>
                            <h1 class="company-name mb-1">@companyDisplayName</h1>
                            <p class="company-email text-dark mb-2">@Model.Email</p>
                            <div class="company-status">
                                <span class="badge @(Model.IsActive ? "bg-success" : "bg-danger") fs-6">
                                    <i class="fas @(Model.IsActive ? "fa-check-circle" : "fa-times-circle") me-1"></i>
                                    @(Model.IsActive ? "Empresa Ativa" : "Empresa Inativa")
                                </span>
                                @if (Model.ServiceType.HasValue)
                                {
                                    <span class="badge @Model.ServiceType.GetServiceTypeColor() text-white fs-6 ms-2">
                                        <i class="@Model.ServiceType.GetServiceTypeIcon() me-1"></i>
                                        @Model.ServiceType.GetServiceTypeDisplayName()
                                    </span>
                                }
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 text-md-end mt-3 mt-md-0">
                    <div class="d-flex flex-wrap gap-2 justify-content-md-end">
                        <a asp-controller="Home" asp-action="Dashboard" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left me-1"></i>Voltar ao Dashboard
                        </a>
                        <button type="submit" form="companyProfileForm" class="btn btn-solar-orange">
                            <i class="fas fa-save me-1"></i>Salvar Alterações
                        </button>
                    </div>
                </div>
            </div>
        </div>

    <!-- Informações da Empresa -->
        <div class="row g-4">
            <!-- Foto e Informações Básicas -->
            <div class="col-lg-4">
                <div class="profile-info-card">
                    <div class="card-body text-center">
                        <div class="company-avatar-large mb-3">
                            <img src="@profileImage" alt="Logo da @companyDisplayName" class="img-fluid" />
                        </div>
                        <h5 class="text-dark fw-bold mb-1">@companyDisplayName</h5>
                        @if (!string.IsNullOrWhiteSpace(Model.CompanyLegalName) && Model.CompanyLegalName != companyDisplayName)
                        {
                            <p class="text-muted small mb-3">@Model.CompanyLegalName</p>
                        }
                        <div class="company-info-stats">
                            <div class="info-stat-item">
                                <span class="info-stat-label">Cadastrada em</span>
                                <span class="info-stat-value">@Model.CreatedAt.ToString("dd/MM/yyyy")</span>
                            </div>
                            @if (!string.IsNullOrWhiteSpace(Model.Location))
                            {
                                <div class="info-stat-item mt-2">
                                    <span class="info-stat-label">Localização</span>
                                    <span class="info-stat-value">@Model.Location</span>
                                </div>
                            }
                        </div>
                    </div>
                </div>

                <!-- Dados Críticos (Não Editáveis) -->
                <div class="profile-critical-card mt-4">
                    <div class="card-header">
                        <h6 class="mb-0 text-white">
                            <i class="fas fa-lock me-2"></i>Dados Críticos (Não Editáveis)
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="critical-field">
                            <label class="critical-label">CNPJ</label>
                            <div class="critical-value">@(Model.CNPJ ?? "Não informado")</div>
                        </div>
                        @if (!string.IsNullOrWhiteSpace(Model.StateRegistration))
                        {
                            <div class="critical-field">
                                <label class="critical-label">Inscrição Estadual</label>
                                <div class="critical-value">@Model.StateRegistration</div>
                            </div>
                        }
                        @if (!string.IsNullOrWhiteSpace(Model.ResponsibleName))
                        {
                            <div class="critical-field">
                                <label class="critical-label">Responsável Cadastrado</label>
                                <div class="critical-value">@Model.ResponsibleName</div>
                            </div>
                        }
                        @if (!string.IsNullOrWhiteSpace(Model.ResponsibleCPF))
                        {
                            <div class="critical-field">
                                <label class="critical-label">CPF do Responsável</label>
                                <div class="critical-value">@Model.ResponsibleCPF</div>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Formulário de Edição -->
            <div class="col-lg-8">
                <form asp-action="UpdateCompany" method="post" enctype="multipart/form-data" id="companyProfileForm">
                    <input type="hidden" asp-for="Id" />
                    
                    @if (!ViewData.ModelState.IsValid)
                    {
                        <div class="alert alert-danger mb-4" role="alert">
                            <h6><i class="fas fa-exclamation-triangle me-2"></i>Erro na validação:</h6>
                            <div asp-validation-summary="All"></div>
                        </div>
                    }

                    <!-- Informações da Empresa (Editáveis) -->
                    <div class="profile-edit-card mb-4">
                        <div class="card-header bg-primary">
                            <h5 class="mb-0 text-white">
                                <i class="fas fa-building me-2"></i>Informações da Empresa
                            </h5>
                            <small class="text-white-50">Campos editáveis - atualize as informações da sua empresa</small>
                        </div>
                        <div class="card-body bg-white">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label asp-for="CompanyTradeName" class="form-label fw-semibold text-dark">
                                            <i class="fas fa-tag text-primary me-2"></i>Nome Fantasia
                                        </label>
                                        <input asp-for="CompanyTradeName" class="form-control text-dark" 
                                               style="color: #000 !important; background-color: #fff !important;"
                                               placeholder="Digite o nome fantasia da empresa" />
                                        <span asp-validation-for="CompanyTradeName" class="text-danger small"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label asp-for="CompanyLegalName" class="form-label fw-semibold text-dark">
                                            <i class="fas fa-certificate text-primary me-2"></i>Razão Social
                                        </label>
                                        <input asp-for="CompanyLegalName" class="form-control text-dark" 
                                               style="color: #000 !important; background-color: #fff !important;"
                                               placeholder="Digite a razão social da empresa" />
                                        <span asp-validation-for="CompanyLegalName" class="text-danger small"></span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="mb-3">
                                        <label asp-for="CompanyDescription" class="form-label fw-semibold text-dark">
                                            <i class="fas fa-align-left text-primary me-2"></i>Descrição da Empresa
                                        </label>
                                        <textarea asp-for="CompanyDescription" class="form-control text-dark" rows="4" 
                                                  style="color: #000 !important; background-color: #fff !important;"
                                                  placeholder="Descreva os serviços e diferenciais da sua empresa. Esta informação aparecerá na página pública da empresa."></textarea>
                                        <span asp-validation-for="CompanyDescription" class="text-danger small"></span>
                                        <div class="form-text text-muted small">Esta descrição aparece na página pública da empresa e ajuda os clientes a conhecer seus serviços.</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label asp-for="ServiceType" class="form-label fw-semibold text-dark">
                                            <i class="fas fa-solar-panel text-primary me-2"></i>Tipo de Serviço Solar
                                        </label>
                                        <select asp-for="ServiceType" class="form-select text-dark" 
                                                style="color: #000 !important; background-color: #fff !important;">
                                            <option value="">Selecione o tipo de serviço</option>
                                            <option value="@((int)SolarEnergy.Models.SolarServiceType.PanelSales)">Venda de Painéis Solares</option>
                                            <option value="@((int)SolarEnergy.Models.SolarServiceType.EnergyRental)">Aluguel de Energia Solar</option>
                                            <option value="@((int)SolarEnergy.Models.SolarServiceType.Both)">Venda e Aluguel</option>
                                        </select>
                                        <span asp-validation-for="ServiceType" class="text-danger small"></span>
                                        <div class="form-text text-muted small">Define quais tipos de serviços sua empresa oferece aos clientes.</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label asp-for="IsActive" class="form-label fw-semibold text-dark">
                                            <i class="fas fa-toggle-on text-primary me-2"></i>Status da Empresa
                                        </label>
                                        <select asp-for="IsActive" class="form-select text-dark" 
                                                style="color: #000 !important; background-color: #fff !important;">
                                            <option value="true">Ativa - Empresa visível nas buscas</option>
                                            <option value="false">Inativa - Empresa oculta das buscas</option>
                                        </select>
                                        <span asp-validation-for="IsActive" class="text-danger small"></span>
                                        <div class="form-text text-muted small">Empresas inativas não aparecem nas buscas públicas dos clientes.</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Contato e Localização -->
                    <div class="profile-edit-card mb-4">
                        <div class="card-header bg-warning">
                            <h5 class="mb-0 text-dark">
                                <i class="fas fa-phone me-2"></i>Contato e Localização
                            </h5>
                            <small class="text-dark-50">Informações de contato visíveis para os clientes</small>
                        </div>
                        <div class="card-body bg-white">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label asp-for="Email" class="form-label fw-semibold text-dark">
                                            <i class="fas fa-envelope text-warning me-2"></i>E-mail Corporativo
                                        </label>
                                        <input asp-for="Email" class="form-control text-dark" type="email"
                                               style="color: #000 !important; background-color: #fff !important;"
                                               placeholder="contato@empresa.com" />
                                        <span asp-validation-for="Email" class="text-danger small"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label asp-for="CompanyWebsite" class="form-label fw-semibold text-dark">
                                            <i class="fas fa-globe text-warning me-2"></i>Site da Empresa
                                        </label>
                                        <input asp-for="CompanyWebsite" class="form-control text-dark" type="url"
                                               style="color: #000 !important; background-color: #fff !important;"
                                               placeholder="https://www.empresa.com.br" />
                                        <span asp-validation-for="CompanyWebsite" class="text-danger small"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label asp-for="Phone" class="form-label fw-semibold text-dark">
                                            <i class="fas fa-mobile-alt text-warning me-2"></i>Telefone Principal
                                        </label>
                                        <input asp-for="Phone" class="form-control text-dark" 
                                               style="color: #000 !important; background-color: #fff !important;"
                                               placeholder="(11) 99999-9999" />
                                        <span asp-validation-for="Phone" class="text-danger small"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label asp-for="CompanyPhone" class="form-label fw-semibold text-dark">
                                            <i class="fas fa-phone text-warning me-2"></i>Telefone Comercial
                                        </label>
                                        <input asp-for="CompanyPhone" class="form-control text-dark" 
                                               style="color: #000 !important; background-color: #fff !important;"
                                               placeholder="(11) 3333-3333" />
                                        <span asp-validation-for="CompanyPhone" class="text-danger small"></span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="mb-3">
                                        <label asp-for="Location" class="form-label fw-semibold text-dark">
                                            <i class="fas fa-map-marker-alt text-warning me-2"></i>Localização
                                        </label>
                                        <input asp-for="Location" class="form-control text-dark" data-city-search="true"
                                               style="color: #000 !important; background-color: #fff !important;"
                                               placeholder="Digite o nome da cidade (ex: São Paulo, SP)" />
                                        <span asp-validation-for="Location" class="text-danger small"></span>
                                        <div class="form-text text-muted small">
                                            <i class="fas fa-info-circle me-1"></i>Digite o nome da cidade e selecione uma das opções sugeridas para padronizar a localização.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Responsável e Imagem -->
                    <div class="profile-edit-card">
                        <div class="card-header bg-info">
                            <h5 class="mb-0 text-white">
                                <i class="fas fa-user-tie me-2"></i>Responsável e Imagem
                            </h5>
                            <small class="text-white-50">Dados do responsável atual e logo da empresa</small>
                        </div>
                        <div class="card-body bg-white">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label asp-for="FullName" class="form-label fw-semibold text-dark">
                                            <i class="fas fa-user text-info me-2"></i>Nome do Responsável Atual
                                        </label>
                                        <input asp-for="FullName" class="form-control text-dark" 
                                               style="color: #000 !important; background-color: #fff !important;"
                                               placeholder="Nome completo do responsável" />
                                        <span asp-validation-for="FullName" class="text-danger small"></span>
                                        <div class="form-text text-muted small">Nome da pessoa responsável pela empresa atualmente.</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label asp-for="ProfileImageFile" class="form-label fw-semibold text-dark">
                                            <i class="fas fa-upload text-info me-2"></i>Logo da Empresa
                                        </label>
                                        <input asp-for="ProfileImageFile" class="form-control text-dark" type="file" accept="image/*" 
                                               style="color: #000 !important; background-color: #fff !important;" />
                                        <span asp-validation-for="ProfileImageFile" class="text-danger small"></span>
                                        <div class="form-text text-muted small">Formatos aceitos: JPG, PNG, GIF, SVG. Tamanho máximo: 2MB.</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}