@model SolarEnergy.ViewModels.PurchaseLeadsViewModel
@{
    ViewData["Title"] = "Comprar Leads";
}

<!-- Lead Purchase CSS -->
<link rel="stylesheet" href="~/css/lead-purchase.css" />

<!-- Breadcrumb Navigation -->
<div class="breadcrumb-container">
    <div class="container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a asp-controller="Home" asp-action="Leads">
                        <i class="fas fa-users"></i> Leads
                    </a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">
                    <i class="fas fa-shopping-cart"></i> Comprar Leads
                </li>
            </ol>
        </nav>
    </div>
</div>

<div class="purchase-container">
    <!-- Hero Section -->
    <section class="purchase-hero">
        <div class="container">
            <div class="hero-content">
                <h1 class="hero-title">
                    <i class="fas fa-rocket me-3"></i>
                    Potencialize Seus Neg√≥cios
                </h1>
                <p class="hero-subtitle">
                    Invista em leads qualificados e acelere o crescimento da sua empresa
                </p>
            </div>
        </div>
    </section>

    <div class="container">
        <!-- Alerts -->
        @if (TempData["Success"] != null)
        {
            <div class="alert-custom alert-success">
                <i class="fas fa-check-circle fa-2x"></i>
                <div>
                    <strong>Perfeito!</strong><br>
                    @TempData["Success"]
                </div>
            </div>
        }

        @if (TempData["Error"] != null)
        {
            <div class="alert-custom alert-danger">
                <i class="fas fa-exclamation-triangle fa-2x"></i>
                <div>
                    <strong>Aten√ß√£o!</strong><br>
                    @TempData["Error"]
                </div>
            </div>
        }

        <!-- Balance Overview -->
        <div class="balance-overview">
            <h2 class="balance-title">
                <i class="fas fa-chart-pie"></i>
                Seu Painel de Controle
            </h2>
            <div class="balance-grid">
                <div class="balance-item">
                    <div class="balance-icon">
                        <i class="fas fa-coins"></i>
                    </div>
                    <div class="balance-number">@Model.Balance.AvailableLeads</div>
                    <div class="balance-label">Leads Dispon√≠veis</div>
                </div>
                <div class="balance-item">
                    <div class="balance-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="balance-number">@Model.Balance.ConsumedLeads</div>
                    <div class="balance-label">Leads Utilizados</div>
                </div>
                <div class="balance-item">
                    <div class="balance-icon">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <div class="balance-number">@Model.Balance.TotalPurchasedLeads</div>
                    <div class="balance-label">Total Comprados</div>
                </div>
                <div class="balance-item">
                    <div class="balance-icon">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="balance-number">@(Model.Balance.TotalSpent.ToString("C0", new System.Globalization.CultureInfo("pt-BR")))</div>
                    <div class="balance-label">Investimento Total</div>
                </div>
            </div>
        </div>

        <!-- Packages Section -->
        <div class="packages-section">
            <h2 class="section-title">Escolha Seu Pacote Ideal</h2>
            <p class="section-subtitle">
                Invista inteligentemente! Quanto mais leads voc√™ compra, maior o desconto e menor o custo por cliente potencial.
            </p>

            <div class="packages-grid">
                @foreach (var package in Model.PackageOptions)
                {
                    <div class="package-card @(package.IsPopular ? "popular" : "")">
                        <div class="package-header">
                            <h3 class="package-name">@package.Name</h3>
                            <p class="package-description">@package.Description</p>

                            <!-- Debug: Mostrar c√°lculos detalhados -->
                            @{
                                decimal subtotal = package.Quantity * package.UnitPrice;
                                decimal finalPricePerLead = package.TotalPrice / package.Quantity;
                            }

                            <div class="package-price">
                                <!-- Pre√ßo Principal -->
                                <div class="price-main">
                                    <span class="price-currency">R$</span>
                                    <span class="price-amount">@(package.TotalPrice.ToString("N2", new System.Globalization.CultureInfo("pt-BR")))</span>
                                </div>
                                <div class="price-detail">@package.Quantity Leads</div>
                                
                                <!-- Breakdown de Pre√ßos -->
                                @if (package.DiscountPercentage > 0)
                                {
                                    <div class="price-breakdown">
                                        <div class="price-comparison">
                                            <span class="original-price">
                                                <del>R$ @(subtotal.ToString("N2", new System.Globalization.CultureInfo("pt-BR")))</del>
                                            </span>
                                            <span class="discount-label">
                                                @(package.DiscountPercentage.ToString("F0"))% OFF
                                            </span>
                                        </div>
                                    </div>
                                }
                                
                                <!-- Pre√ßo por Lead -->
                                <div class="price-per-unit">
                                    <span class="unit-price-label">Pre√ßo por lead:</span>
                                    <span class="unit-price-value">R$ @(finalPricePerLead.ToString("N2", new System.Globalization.CultureInfo("pt-BR")))</span>
                                    @if (package.DiscountPercentage > 0)
                                    {
                                        <span class="unit-price-original">
                                            <del>R$ @(package.UnitPrice.ToString("N2", new System.Globalization.CultureInfo("pt-BR")))</del>
                                        </span>
                                    }
                                </div>
                            </div>

                            @if (package.DiscountPercentage > 0)
                            {
                                <div class="savings-badge">
                                    <i class="fas fa-piggy-bank"></i>
                                    Economia: @(package.Savings.ToString("C", new System.Globalization.CultureInfo("pt-BR")))
                                </div>
                            }
                        </div>

                        <div class="package-body">
                            <div class="benefits-grid">
                                <div class="benefit-item">
                                    <div class="benefit-icon">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <span class="benefit-text">@package.Quantity Leads Premium</span>
                                </div>
                                <div class="benefit-item">
                                    <div class="benefit-icon">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <span class="benefit-text">Dados Completos</span>
                                </div>
                                <div class="benefit-item">
                                    <div class="benefit-icon">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <span class="benefit-text">Chat Liberado</span>
                                </div>
                                <div class="benefit-item">
                                    <div class="benefit-icon">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <span class="benefit-text">Contatos Diretos</span>
                                </div>
                                <div class="benefit-item">
                                    <div class="benefit-icon">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <span class="benefit-text">Nunca Expira</span>
                                </div>
                                <div class="benefit-item">
                                    <div class="benefit-icon">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <span class="benefit-text">Suporte 24/7</span>
                                </div>
                                @if (package.DiscountPercentage > 0)
                                {
                                    <div class="benefit-item">
                                        <div class="benefit-icon">
                                            <i class="fas fa-percent"></i>
                                        </div>
                                        <span class="benefit-text">@package.DiscountPercentage% Desconto</span>
                                    </div>
                                    <div class="benefit-item">
                                        <div class="benefit-icon">
                                            <i class="fas fa-star"></i>
                                        </div>
                                        <span class="benefit-text">Melhor Custo</span>
                                    </div>
                                }
                            </div>

                            <form asp-action="Purchase" method="post">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="packageType" value="@package.Type" />
                                <button type="submit" class="purchase-btn" onclick="this.classList.add('loading')">
                                    <i class="fas fa-shopping-cart me-2"></i>
                                    Comprar Agora
                                </button>
                            </form>
                        </div>
                    </div>
                }
            </div>
        </div>

        <!-- Purchase History -->
        @if (Model.RecentPurchases.Any())
        {
            <div class="history-section">
                <div class="history-header">
                    <i class="fas fa-history fa-2x"></i>
                    <h3 class="history-title">Hist√≥rico de Compras Recentes</h3>
                </div>

                <div class="history-body">
                    <div class="table-responsive">
                        <table class="history-table">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Quantidade</th>
                                    <th>Valor</th>
                                    <th>Desconto</th>
                                    <th>Transa√ß√£o</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var purchase in Model.RecentPurchases)
                                {
                                    <tr>
                                        <td>
                                            <strong>@purchase.PurchaseDate.ToString("dd/MM/yyyy")</strong><br>
                                            <small style="color: var(--solar-muted);">@purchase.PurchaseDate.ToString("HH:mm")</small>
                                        </td>
                                        <td>
                                            <strong>@purchase.LeadQuantity</strong> leads
                                        </td>
                                        <td>
                                            <span class="amount-highlight">@(purchase.TotalAmount.ToString("C", new System.Globalization.CultureInfo("pt-BR")))</span>
                                        </td>
                                        <td>
                                            @if (purchase.DiscountPercentage > 0)
                                            {
                                                <span class="discount-badge">@purchase.DiscountPercentage%</span>
                                            }
                                            else
                                            {
                                                <span style="color: var(--solar-muted);">‚Äî</span>
                                            }
                                        </td>
                                        <td>
                                            <span class="transaction-badge">@purchase.TransactionId</span>
                                        </td>
                                        <td>
                                            <span class="status-success">
                                                <i class="fas fa-check me-1"></i>
                                                Conclu√≠da
                                            </span>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>

                    <div class="text-center mt-4">
                        <a asp-action="Management" class="nav-btn secondary">
                            <i class="fas fa-chart-line"></i>
                            Ver Relat√≥rio Completo
                        </a>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

<!-- Navigation -->
<div class="container mt-4">
    <div class="navigation-section">
        <div class="nav-buttons">
            <a asp-controller="Home" asp-action="Leads" class="nav-btn">
                <i class="fas fa-arrow-left"></i>
                Voltar aos Leads
            </a>
            <a asp-action="Management" class="nav-btn secondary">
                <i class="fas fa-chart-bar"></i>
                Gerenciar Leads
            </a>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-remove success alerts
    const successAlerts = document.querySelectorAll('.alert-success');
    successAlerts.forEach(alert => {
        setTimeout(() => {
            alert.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
            alert.style.opacity = '0';
            alert.style.transform = 'translateY(-20px)';
            setTimeout(() => alert.remove(), 500);
        }, 5000);
    });

    // Package card interactions
    const packageCards = document.querySelectorAll('.package-card');
    packageCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            if (!this.classList.contains('popular')) {
                this.style.transform = 'translateY(-10px) scale(1.02)';
            }
        });
        
        card.addEventListener('mouseleave', function() {
            if (!this.classList.contains('popular')) {
                this.style.transform = 'translateY(0) scale(1)';
            } else {
                this.style.transform = 'scale(1.05)';
            }
        });
    });

    // Enhanced purchase confirmation
    const purchaseButtons = document.querySelectorAll('.purchase-btn');
    purchaseButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            const packageCard = this.closest('.package-card');
            const packageName = packageCard.querySelector('.package-name').textContent.trim();
            const packagePrice = packageCard.querySelector('.price-amount').textContent.trim();
            
            const confirmed = confirm(
                `üõí Confirma√ß√£o de Compra\n\n` +
                `üì¶ Pacote: ${packageName}\n` +
                `üí∞ Investimento: R$ ${packagePrice}\n\n` +
                `‚úîÔ∏è Seus leads ser√£o creditados automaticamente!\n` +
                `üîí Em produ√ß√£o: direcionamento para pagamento seguro\n\n` +
                `Confirma a compra deste pacote?`
            );
            
            if (!confirmed) {
                e.preventDefault();
                this.classList.remove('loading');
                return false;
            }
            
            // Visual feedback
            this.innerHTML = '<i class="fas fa-check me-2"></i>Processando Compra...';
            this.style.background = 'linear-gradient(135deg, var(--solar-success) 0%, #4caf50 100%)';
        });
    });

    // Balance items animation on load
    const balanceItems = document.querySelectorAll('.balance-item');
    balanceItems.forEach((item, index) => {
        item.style.opacity = '0';
        item.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            item.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
            item.style.opacity = '1';
            item.style.transform = 'translateY(0)';
        }, index * 200);
    });

    // Package cards staggered animation
    packageCards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(30px)';
        
        setTimeout(() => {
            card.style.transition = 'opacity 0.8s ease, transform 0.8s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, 500 + (index * 300));
    });
});
</script></script>