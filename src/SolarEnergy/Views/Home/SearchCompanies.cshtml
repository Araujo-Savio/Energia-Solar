@using System.Linq
@using SolarEnergy.Extensions
@model SolarEnergy.ViewModels.CompanySearchViewModel
@{
    ViewData["Title"] = "Buscar Empresas";
}

<section class="bg-light py-5">
    <div class="container">
        <div class="text-center mb-5">
            <span class="badge bg-solar-orange bg-opacity-75 text-uppercase fw-semibold px-3 py-2">Encontre a parceira ideal</span>
            <h1 class="display-6 text-solar-blue fw-bold mt-3">Busque empresas especializadas em energia solar</h1>
            <p class="text-muted lead">Pesquise por nome, cidade ou especialidade para encontrar empresas cadastradas na plataforma.</p>
        </div>

        <form method="get" class="row g-2 justify-content-center mb-5">
            <div class="col-12 col-lg-6">
                <div class="input-group input-group-lg shadow-sm">
                    <span class="input-group-text bg-white border-end-0"><i class="fas fa-search text-solar-orange"></i></span>
                    <input type="text" class="form-control border-start-0" name="term" value="@Model.SearchTerm" placeholder="Busque por nome da empresa ou localização" />
                </div>
            </div>
            <div class="col-auto d-flex align-items-center">
                <button type="submit" class="btn btn-solar-orange btn-lg px-4">
                    <i class="fas fa-search me-2"></i>Pesquisar
                </button>
            </div>
        </form>

        @if (Model.Companies.Any())
        {
            <div class="row mb-3">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="text-solar-blue fw-bold mb-0">
                            <i class="fas fa-building me-2"></i>
                            @Model.Companies.Count @(Model.Companies.Count == 1 ? "empresa encontrada" : "empresas encontradas")
                        </h5>
                        <small class="text-muted">Clique em qualquer card para ver mais detalhes</small>
                    </div>
                </div>
            </div>
        }

        <div class="row g-4">
            @if (Model.Companies.Any())
            {
                foreach (var company in Model.Companies)
                {
                    <div class="col-12 col-md-6 col-xl-4">
                        <div class="company-card-modern h-100">
                            <a href="@Url.Action("CompanyDetails", "Home", new { id = company.Id })" class="card-link-full"></a>
                            
                            <!-- Card Header com Gradiente -->
                            <div class="card-header-gradient">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div class="company-icon">
                                        <i class="fas fa-solar-panel"></i>
                                    </div>
                                    @if (company.ServiceType.HasValue)
                                    {
                                        <div class="service-type-badge">
                                            <span class="badge @company.ServiceType.GetServiceTypeColor() text-white">
                                                <i class="@company.ServiceType.GetServiceTypeIcon() me-1"></i>
                                                @company.ServiceType.GetServiceTypeDisplayName()
                                            </span>
                                        </div>
                                    }
                                </div>
                            </div>

                            <!-- Card Body -->
                            <div class="card-body-modern p-4">
                                <!-- Company Name -->
                                <div class="company-name-section mb-3">
                                    <h5 class="company-name fw-bold text-solar-blue mb-1">@company.Name</h5>
                                    @if (!string.IsNullOrWhiteSpace(company.LegalName) && company.LegalName != company.Name)
                                    {
                                        <small class="text-muted">@company.LegalName</small>
                                    }
                                </div>

                                <!-- Company Description -->
                                @if (!string.IsNullOrWhiteSpace(company.Description))
                                {
                                    <div class="company-description mb-3">
                                        <p class="text-muted small mb-0 description-text">@company.Description</p>
                                    </div>
                                }

                                <!-- Company Info -->
                                <div class="company-info mb-4">
                                    @if (!string.IsNullOrWhiteSpace(company.Location))
                                    {
                                        <div class="info-item mb-2">
                                            <div class="info-icon">
                                                <i class="fas fa-map-marker-alt text-solar-orange"></i>
                                            </div>
                                            <span class="info-text">@company.Location</span>
                                        </div>
                                    }
                                    
                                    @if (!string.IsNullOrWhiteSpace(company.Website))
                                    {
                                        <div class="info-item mb-2">
                                            <div class="info-icon">
                                                <i class="fas fa-globe text-solar-orange"></i>
                                            </div>
                                            <span class="info-text">Site oficial</span>
                                        </div>
                                    }

                                    @if (company.ServiceType.HasValue)
                                    {
                                        <div class="info-item mb-2">
                                            <div class="info-icon">
                                                <i class="@company.ServiceType.GetServiceTypeIcon() text-solar-orange"></i>
                                            </div>
                                            <span class="info-text">@company.ServiceType.GetServiceTypeDisplayName()</span>
                                        </div>
                                    }
                                </div>

                                <!-- Card Footer -->
                                <div class="card-footer-modern">
                                    <div class="d-flex justify-content-between align-items-center">
                                        @if (company.TotalReviews > 0)
                                        {
                                            <div class="company-rating">
                                                <div class="stars">
                                                    @for (int i = 1; i <= 5; i++)
                                                    {
                                                        if (i <= Math.Floor(company.AverageRating))
                                                        {
                                                            <i class="fas fa-star"></i>
                                                        }
                                                        else if (i <= Math.Ceiling(company.AverageRating))
                                                        {
                                                            <i class="fas fa-star-half-alt"></i>
                                                        }
                                                        else
                                                        {
                                                            <i class="far fa-star"></i>
                                                        }
                                                    }
                                                </div>
                                                <small class="text-muted ms-1">@company.AverageRating.ToString("F1") (@company.TotalReviews @(company.TotalReviews == 1 ? "avaliação" : "avaliações"))</small>
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="company-rating">
                                                <div class="stars text-muted">
                                                    <i class="far fa-star"></i>
                                                    <i class="far fa-star"></i>
                                                    <i class="far fa-star"></i>
                                                    <i class="far fa-star"></i>
                                                    <i class="far fa-star"></i>
                                                </div>
                                                <small class="text-muted ms-1">Sem avaliações</small>
                                            </div>
                                        }
                                        <div class="view-details">
                                            <span class="view-details-text">
                                                Ver detalhes <i class="fas fa-arrow-right ms-1"></i>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hover Overlay Effect -->
                            <div class="card-overlay"></div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="col-12">
                    <div class="empty-state-card">
                        <div class="empty-state-content text-center py-5">
                            <div class="empty-state-icon mb-4">
                                <i class="fas fa-search-minus fa-4x text-solar-orange opacity-50"></i>
                            </div>
                            <h4 class="text-solar-blue fw-bold mb-3">Nenhuma empresa encontrada</h4>
                            <p class="text-muted mb-4">Não encontramos empresas que correspondam aos seus critérios de busca.</p>
                            <div class="empty-state-suggestions">
                                <p class="small text-muted mb-2">Sugestões:</p>
                                <ul class="list-unstyled small text-muted">
                                    <li>• Tente termos mais genéricos</li>
                                    <li>• Verifique a ortografia</li>
                                    <li>• Busque por cidade ou região</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</section>
